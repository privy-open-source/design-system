import{d as M,p as v,aF as S,a6 as $,h as k,c as N,j as x,K as F,r as V,k as f,n as O,a0 as y,o as j,P as I}from"./framework.CI6Dj8yt.js";import{u as P}from"./index.CM3hlGhp.js";import{t as T}from"./base64.CRVHLH2y.js";import{w as H}from"./index.CQImwLBD.js";function L(n,p){return n?p.filter(c=>{const t=String(c.name).toLowerCase(),d=String(c.type).toLowerCase();return n.split(",").some(s=>{const l=s.trim().toLowerCase();return l.charAt(0)==="."?t.endsWith(l):l.endsWith("/*")?d.replace(/\/.*$/,"")===l.replace(/\/.*$/,""):d===l})}):p}const W=["multiple","accept","disabled"],q=M({inheritAttrs:!1,__name:"Dropzone",props:{modelValue:{type:[globalThis.File,Array,String],default:void 0},modelModifiers:{type:Object,default:()=>({})},multiple:{type:[Boolean,String],default:!1},maxlength:{type:[Number,String],default:void 0},accept:{type:String,default:""},clearOnCancel:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},containerClass:{type:[String,Array,Object],default:void 0}},emits:["update:modelValue","change","cancel"],setup(n,{expose:p,emit:c}){const t=n,d=c,i=P(t),s=v(),l=v(),b=S($(t,"maxlength"),{method:"parseInt"}),u=v(!1),m=v(!1),w=k(()=>{const e=[];return u.value&&e.push("dropzone--dragover"),m.value&&e.push("dropzone--hover"),t.disabled&&e.push("dropzone--disabled"),t.readonly&&e.push("dropzone--readonly"),e}),{ignoreUpdates:z}=H(()=>t.modelValue,e=>{e&&(Array.isArray(e)?s.value=e.filter(a=>a instanceof globalThis.File):e instanceof globalThis.File&&(s.value=e))},{immediate:!0});function h(){l.value.value="",l.value.click()}function g(){l.value.value="",s.value=void 0,i.value=void 0}function C(e){if(!t.disabled&&!t.readonly){const a=e.dataTransfer.files;u.value=!1,A(a)}}function B(e){const a=e.target,o=a.files;A(o),t.multiple==="append"&&I(()=>{a.value=""})}function D(e){return Array.isArray(e)?Promise.all(e.map(a=>T(a))):T(e)}async function A(e){if(e.length>0){const a=L(t.accept,Array.from(e)),o=t.multiple===!1?a.at(0):a;let r=o;t.multiple==="append"&&Array.isArray(i.value)&&(r=[...i.value,...r]),Number.isInteger(b.value)&&Array.isArray(r)&&(r=r.slice(0,b.value)),s.value=r,t.modelModifiers.base64&&(r=await D(o)),z(()=>{i.value=r}),d("change",r)}else t.clearOnCancel&&g(),d("cancel")}return p({browse:h,clear:g,input:l}),(e,a)=>(j(),N("label",{class:O(["dropzone",[f(w),n.containerClass]]),"data-testid":"dropzone",onDrop:y(C,["prevent"]),onDragover:a[0]||(a[0]=y(()=>{},["prevent"])),onDragenter:a[1]||(a[1]=y(o=>u.value=!0,["prevent"])),onDragleave:a[2]||(a[2]=y(o=>u.value=!1,["prevent"])),onMouseover:a[3]||(a[3]=o=>m.value=!0),onMouseout:a[4]||(a[4]=o=>m.value=!1)},[x("input",F({ref_key:"input",ref:l,"data-testid":"dropzone-input",class:"dropzone__input",type:"file",multiple:n.multiple!==!1,accept:n.accept,disabled:n.disabled||n.readonly},e.$attrs,{onChange:B}),null,16,W),V(e.$slots,"default",{isDragover:f(u),isHovered:f(m),disabled:n.disabled,readonly:n.readonly,model:f(i),rawModel:f(s),browse:h,clear:g})],34))}});export{q as _};
