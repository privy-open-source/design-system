import{d as C,r as v,as as D,t as $,l as S,c as N,m as k,M as x,a as V,p as f,n as O,a2 as y,o as F,R as H}from"./framework.Ae0H8jK5.js";import{u as I}from"./index.CD5JWynm.js";import{t as A}from"./base64.CRVHLH2y.js";function L(l,p){return l?p.filter(c=>{const t=String(c.name).toLowerCase(),i=String(c.type).toLowerCase();return l.split(",").some(u=>{const n=u.trim().toLowerCase();return n.charAt(0)==="."?t.endsWith(n):n.endsWith("/*")?i.replace(/\/.*$/,"")===n.replace(/\/.*$/,""):i===n})}):p}const P=["multiple","accept","disabled"],E=C({__name:"Dropzone",props:{modelValue:{type:[globalThis.File,Array,String],default:void 0},modelModifiers:{type:Object,default:()=>({})},multiple:{type:[Boolean,String],default:!1},maxlength:{type:[Number,String],default:void 0},accept:{type:String,default:""},clearOnCancel:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","change","cancel"],setup(l,{expose:p,emit:c}){const t=l,i=c,s=I(t),u=v(),n=v(),b=D($(t,"maxlength"),{method:"parseInt"}),d=v(!1),m=v(!1),B=S(()=>{const a=[];return d.value&&a.push("dropzone--dragover"),m.value&&a.push("dropzone--hover"),t.disabled&&a.push("dropzone--disabled"),t.readonly&&a.push("dropzone--readonly"),a});function h(){n.value.value="",n.value.click()}function g(){n.value.value="",u.value=void 0,s.value=void 0}function M(a){if(!t.disabled&&!t.readonly){const e=a.dataTransfer.files;d.value=!1,z(e)}}function T(a){const e=a.target,o=e.files;z(o),t.multiple==="append"&&H(()=>{e.value=""})}function w(a){return Array.isArray(a)?Promise.all(a.map(e=>A(e))):A(a)}async function z(a){if(a.length>0){const e=L(t.accept,Array.from(a)),o=t.multiple===!1?e.at(0):e;let r=o;t.multiple==="append"&&Array.isArray(s.value)&&(r=[...s.value,...r]),Number.isInteger(b.value)&&Array.isArray(r)&&(r=r.slice(0,b.value)),u.value=r,t.modelModifiers.base64&&(r=await w(o)),s.value=r,i("change",r)}else t.clearOnCancel&&g(),i("cancel")}return p({browse:h,clear:g,input:n}),(a,e)=>(F(),N("label",{class:O(["dropzone",f(B)]),"data-testid":"dropzone",onDrop:y(M,["prevent"]),onDragover:e[0]||(e[0]=y(()=>{},["prevent"])),onDragenter:e[1]||(e[1]=y(o=>d.value=!0,["prevent"])),onDragleave:e[2]||(e[2]=y(o=>d.value=!1,["prevent"])),onMouseover:e[3]||(e[3]=o=>m.value=!0),onMouseout:e[4]||(e[4]=o=>m.value=!1)},[k("input",x({ref_key:"input",ref:n,"data-testid":"dropzone-input",class:"dropzone__input",type:"file",multiple:l.multiple!==!1,accept:l.accept,disabled:l.disabled||l.readonly},a.$attrs,{onChange:T}),null,16,P),V(a.$slots,"default",{isDragover:f(d),isHovered:f(m),disabled:l.disabled,readonly:l.readonly,model:f(s),rawModel:f(u),browse:h,clear:g})],34))}});export{E as _};
