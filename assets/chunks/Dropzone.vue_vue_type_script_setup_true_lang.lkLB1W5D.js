import{d as C,r as v,as as D,t as $,l as S,c as N,m as k,M as x,a as V,p,n as O,a2 as y,o as F,R as H}from"./framework.SPHuL2wz.js";import{u as I}from"./index.CFXyWZro.js";import{t as A}from"./base64.CRVHLH2y.js";function L(o,f){return o?f.filter(c=>{const t=String(c.name).toLowerCase(),i=String(c.type).toLowerCase();return o.split(",").some(u=>{const l=u.trim().toLowerCase();return l.charAt(0)==="."?t.endsWith(l):l.endsWith("/*")?i.replace(/\/.*$/,"")===l.replace(/\/.*$/,""):i===l})}):f}const P=["multiple","accept","disabled"],E=C({__name:"Dropzone",props:{modelValue:{type:[globalThis.File,Array,String],default:void 0},modelModifiers:{type:Object,default:()=>({})},multiple:{type:[Boolean,String],default:!1},maxlength:{type:[Number,String],default:void 0},accept:{type:String,default:""},clearOnCancel:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","change","cancel"],setup(o,{expose:f,emit:c}){const t=o,i=c,s=I(t),u=v(),l=v(),b=D($(t,"maxlength"),{method:"parseInt"}),d=v(!1),m=v(!1),B=S(()=>{const a=[];return d.value&&a.push("dropzone--dragover"),m.value&&a.push("dropzone--hover"),t.disabled&&a.push("dropzone--disabled"),t.readonly&&a.push("dropzone--readonly"),a});function h(){l.value.value="",l.value.click()}function g(){l.value.value="",u.value=void 0,s.value=void 0}function M(a){if(!t.disabled&&!t.readonly){const e=a.dataTransfer.files;d.value=!1,z(e)}}function T(a){const e=a.target,r=e.files;z(r),t.multiple==="append"&&H(()=>{e.value=""})}function w(a){return Array.isArray(a)?Promise.all(a.map(e=>A(e))):A(a)}async function z(a){if(a.length>0){const e=L(t.accept,Array.from(a)),r=t.multiple===!1?e.at(0):e;let n=r;t.multiple==="append"&&Array.isArray(s.value)&&(n=[...s.value,...n]),Number.isInteger(b.value)&&Array.isArray(n)&&(n=n.slice(0,b.value)),u.value=n,t.modelModifiers.base64&&(n=await w(r)),s.value=n,i("change",n)}else t.clearOnCancel&&g(),i("cancel")}return f({browse:h,clear:g,input:l}),(a,e)=>(F(),N("label",{class:O(["dropzone",p(B)]),"data-testid":"dropzone",onDrop:y(M,["prevent"]),onDragover:e[0]||(e[0]=y(()=>{},["prevent"])),onDragenter:e[1]||(e[1]=y(r=>d.value=!0,["prevent"])),onDragleave:e[2]||(e[2]=y(r=>d.value=!1,["prevent"])),onMouseover:e[3]||(e[3]=r=>m.value=!0),onMouseout:e[4]||(e[4]=r=>m.value=!1)},[k("input",x({ref_key:"input",ref:l,"data-testid":"dropzone-input",class:"dropzone__input",type:"file",multiple:o.multiple!==!1,accept:o.accept,disabled:o.disabled||o.readonly},a.$attrs,{onChange:T}),null,16,P),V(a.$slots,"default",{isDragover:p(d),isHovered:p(m),disabled:o.disabled,readonly:o.readonly,model:p(s),rawModel:p(u),browse:h,clear:g})],34))}});export{E as _};
