import{p as z}from"./chunks/Button.b510dd8b.js";import{_ as H,x as h,p as g,G as p,m as G,t as J,r as C,c as O,o as K,h as ee,L as N,a8 as se,a7 as ae,C as q,Q as n,B as y,z as j,T as te,A as U,q as oe,v as ne,a0 as le,u as x,X as v,y as T,i as Y}from"./chunks/framework.fc7d399c.js";import{u as re}from"./chunks/index.7693578c.js";import{f as Q}from"./chunks/base64.041d95b4.js";import{u as ce,a as pe,b as ie,c as de}from"./chunks/theme.e13a306b.js";import{a as Z}from"./chunks/index.71f67157.js";import{d as ue}from"./chunks/defu.573334b8.js";import{p as me}from"./chunks/index.a6d4f938.js";import{p as ye}from"./chunks/Banner.4dd86394.js";import"./chunks/index.a3ecab28.js";import"./chunks/Button.vue_vue_type_style_index_0_lang.4ed993c7.js";import"./chunks/use-singleton.172124a7.js";import"./chunks/20.e4f9f491.js";import"./chunks/16.8343540f.js";import"./chunks/Banner.vue_vue_type_style_index_0_lang.4ed993c7.js";const he={},De={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",class:"persona-icon"},_e=p("path",{fill:"currentColor",d:"M5.743 2.44A6 6 0 0 1 14 7.935a.5.5 0 0 0 1-.01A7 7 0 0 0 2.722 3.401V1.5a.5.5 0 1 0-1 0v2.889a.5.5 0 0 0 .5.5h2.89a.5.5 0 1 0 0-1H3.63A6 6 0 0 1 5.743 2.44ZM9.945 13.676a6 6 0 0 1-7.944-5.755.5.5 0 0 0-1-.013 7 7 0 0 0 12.277 4.69V14.5a.5.5 0 1 0 1 0v-2.889a.5.5 0 0 0-.5-.5h-2.889a.5.5 0 0 0 0 1h1.482a6 6 0 0 1-2.426 1.565Z"},null,-1),Fe=[_e];function ve(e,s){return h(),g("svg",De,Fe)}const fe=H(he,[["render",ve]]),ge={},Ce={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",class:"persona-icon"},Ae=p("path",{fill:"currentColor",d:"M12 9.171a3.852 3.852 0 0 0-3.846 3.858A3.852 3.852 0 0 0 12 16.886a3.852 3.852 0 0 0 3.846-3.857A3.852 3.852 0 0 0 12 9.17ZM9.692 13.03A2.311 2.311 0 0 1 12 10.714a2.311 2.311 0 0 1 2.308 2.315A2.311 2.311 0 0 1 12 15.343a2.311 2.311 0 0 1-2.308-2.314Z"},null,-1),be=p("path",{fill:"currentColor",d:"M10.798 3c-.748 0-1.465.298-1.994.829l-2.25 2.257h-.708A3.852 3.852 0 0 0 2 9.943v7.2A3.852 3.852 0 0 0 5.846 21h12.308A3.852 3.852 0 0 0 22 17.143v-7.2a3.852 3.852 0 0 0-3.846-3.857h-.707l-2.251-2.258A2.816 2.816 0 0 0 13.202 3h-2.404Zm-.906 1.92a1.28 1.28 0 0 1 .906-.377h2.404c.34 0 .666.135.906.376l2.476 2.484c.145.144.34.226.544.226h1.026a2.31 2.31 0 0 1 2.308 2.314v7.2a2.31 2.31 0 0 1-2.308 2.314H5.846a2.311 2.311 0 0 1-2.308-2.314v-7.2a2.311 2.311 0 0 1 2.308-2.314h1.026c.204 0 .4-.082.544-.226l2.476-2.484Z"},null,-1),ke=[Ae,be];function Te(e,s){return h(),g("svg",Ce,ke)}const we=H(ge,[["render",Te]]),Pe={},Se={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",class:"persona-icon"},qe=p("path",{fill:"currentColor",d:"M4.564 2.77a.77.77 0 0 0-1.538 0v4.102a.77.77 0 0 0 .769.769h4.102a.77.77 0 1 0 0-1.538H5.932a8.461 8.461 0 1 1-2.393 5.804.77.77 0 0 0-1.538-.017 10 10 0 1 0 2.563-6.576V2.769Z"},null,-1),xe=[qe];function Ee(e,s){return h(),g("svg",Se,xe)}const Ie=H(Pe,[["render",Ee]]),Ve="/design-system/assets/shutter.9f40c7bb.wav";function L(e,s=!1){const a=document.createElement("canvas"),r=a.getContext("2d");return a.width=e.videoWidth,a.height=e.videoHeight,s?(r.save(),r.scale(-1,1),r.drawImage(e,0,0,a.width*-1,a.height),r.restore()):r.drawImage(e,0,0,a.width,a.height),a.toDataURL("image/jpeg")}const Me={meta:{facingMode:"environment"},run({video:e,meta:s,modifier:a}){const r=!!(s.value.mirror&&s.value.mirror!=="preview"),l=L(e.value,r),t=a.value.base64?l:Q(l);return{preview:l,result:t}}},Re=G({components:{pButton:z,IconCamera:we,IconRetake:Ie,IconRotate:fe},directives:{pAspectRatio:me},props:{modelValue:{type:[globalThis.File,String,Array],default:""},modelModifiers:{type:Object,default:()=>({})},mirror:{type:[Boolean,String],default:void 0},mask:{type:String,default:void 0},adapter:{type:Object,default:Me},facingMode:{type:String,default:void 0},silent:{type:Boolean,default:!1}},models:{prop:"modelValue",event:"update:modelValue"},emits:["start","change","result","update:modelValue"],setup(e,{emit:s}){const a=re(e),r=J(e,"modelModifiers"),l=C(!1),t=C(!1),c=C(""),i=C(""),o=C(),D=C(),_=ce("camera",{controls:!0}),d=C(0),m=O(()=>ue({mirror:e.mirror,mask:e.mask,facingMode:e.facingMode},e.adapter.meta,{autoStart:!1})),{videoInputs:f}=pe({requestPermissions:!1,constraints:{video:{facingMode:m.value.facingMode}}}),w=O(()=>{var u,$;return($=(u=f.value)==null?void 0:u.at(d.value))==null?void 0:$.deviceId}),k=O(()=>({video:{deviceId:w.value},audio:!1})),{stream:A,start:E,stop:I,enabled:V}=ie({constraints:k}),M=O(()=>{const u=[];return m.value.mirror&&u.push("camera--mirror"),m.value.mask?u.push(`camera__mask--${m.value.mask}`):u.push("camera__mask--none"),u});async function P(){var u;_.state.value==="denied"&&await Z({title:"Camera Access Blocked",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),_.state.value==="prompt"&&await Z({title:"Camera Access Required",text:"Privy need to access your internal camera to process this journey",confirm:{text:"Ok"},footerAlign:"end"}),await E(),typeof((u=D.value)==null?void 0:u.play)=="function"&&await D.value.play()}function B(){d.value=(d.value+1)%f.value.length}function R(u){i.value=u}async function S(){var $;l.value=!0;const u=await e.adapter.run({video:D,toast:R,stream:A,meta:m,modifier:r});c.value=u.preview,a.value=u.result,t.value=!0,l.value=!1,V.value=!1,s("result",u.result),s("change",u.result),typeof(($=o.value)==null?void 0:$.play)=="function"&&o.value.play()}async function X(){V.value=!0,t.value=!1,c.value="",i.value=""}function W(){s("start",A.value),m.value.autoStart&&S()}return K(async()=>{_.isSupported&&(await de(_.state).not.toBeUndefined(),await P())}),ee(()=>{I()}),{ShutterWav:Ve,classNames:M,cameras:f,video:D,shutter:o,stream:A,toggle:B,isActive:V,isTaken:t,isProcessing:l,message:i,take:S,retake:X,preview:c,turnOn:P,onStart:W,toast:R,deviceId:w,constraints:k}}});const $e=["data-deviceid"],Ne=[".srcObject"],Be=["src"],Oe={key:2,"data-testid":"camera-off",class:"camera__off-info"},Ue={class:"camera__mask-container"},Le={key:0,"data-testid":"camera-mask",class:"camera__mask"},He={"data-testid":"camera-toast",class:"camera__toast-text"},je={class:"camera__controls"},Qe=["src","muted"];function Ye(e,s,a,r,l,t){const c=N("icon-rotate"),i=N("p-button"),o=N("icon-camera"),D=N("icon-retake"),_=se("p-aspect-ratio");return ae((h(),g("div",{class:ne(["camera",e.classNames]),"data-testid":"camera","data-deviceid":e.deviceId},[e.stream?(h(),g("video",{key:0,ref:"video","data-testid":"camera-video",".srcObject":e.stream,class:"camera__video",autoplay:"",muted:"",playsinline:"",onPlay:s[0]||(s[0]=(...d)=>e.onStart&&e.onStart(...d))},null,40,Ne)):q("",!0),e.isTaken&&!e.stream?(h(),g("img",{key:1,"data-testid":"camera-result",class:"camera__result",src:e.preview,alt:"camera-result"},null,8,Be)):q("",!0),!e.isActive&&!e.isTaken?(h(),g("span",Oe," Camera is off ")):q("",!0),p("div",Ue,[e.isTaken?q("",!0):(h(),g("div",Le))]),n(te,{name:"slide-up"},{default:y(()=>[e.message?(h(),g("div",{key:e.message,class:"camera__toast"},[p("div",He,j(e.message),1)])):q("",!0)]),_:1}),p("div",je,[e.cameras.length>1&&!e.isTaken?(h(),U(i,{key:0,"data-testid":"camera-toggle",color:"danger",size:"sm",icon:"",pill:"",onClick:e.toggle},{default:y(()=>[n(c)]),_:1},8,["onClick"])):q("",!0),!e.isActive&&!e.isTaken?(h(),U(i,{key:1,"data-testid":"camera-turn-on",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[1]||(s[1]=d=>e.turnOn())},{default:y(()=>[n(o)]),_:1})):e.isActive&&!e.isTaken?(h(),U(i,{key:2,"data-testid":"camera-take",class:"camera__main-control",color:"danger",icon:"",pill:"",disabled:e.isProcessing,onClick:s[2]||(s[2]=d=>e.take())},{default:y(()=>[n(o)]),_:1},8,["disabled"])):(h(),U(i,{key:3,"data-testid":"camera-retake",class:"camera__main-control",color:"danger",icon:"",pill:"",onClick:s[3]||(s[3]=d=>e.retake())},{default:y(()=>[n(D)]),_:1}))]),p("audio",{ref:"shutter",src:e.ShutterWav,muted:e.silent},null,8,Qe),oe(e.$slots,"default",{cameras:e.cameras,preview:e.preview,stream:e.stream,video:e.video,shutter:e.shutter,toast:e.toast})],10,$e)),[[_,4/3,void 0,{fixed:!0}]])}const F=H(Re,[["render",Ye]]),Ze=40,Xe=15,b=160;function We(e,s){const a=e.getContext("2d",{willReadFrequently:!0});return a.drawImage(s,s.videoWidth/2-b,s.videoHeight/2-b,b,b,0,0,b,b),a.getImageData(0,0,e.width,e.height)}function ze(e){const s=e.width/2,a=e.height/2,r=e.width/4,l=e.height/4,t=s-r/2,c=a-l/2,i=new Uint8ClampedArray(r*l),o={centerX:s,centerY:a,width:r,height:l,xPos:t,yPos:c,buffer:i},D=e.data;let _=0;for(let d=o.yPos;d<o.yPos+o.height;d++){let m=d*e.width*4+o.xPos*4+1;for(let f=o.xPos;f<o.xPos+o.width;f++)o.buffer[_++]=D[m],m+=4}return o}function Ge(e,s){let a=0,r=0,l=0;const t=e.width/4,c=e.height/4,i=e.data;for(let k=s.centerY-c;k<=s.centerY+c-s.height;k++)for(let A=s.centerX-t;A<=s.centerX+t-s.width;A++){let E=0,I=0,V=0;for(let P=0;P<s.height;P++){let B=A*4+1+(k+P)*e.width*4;for(let R=0;R<s.width;R++){const S=i[B];E+=s.buffer[V++]*S,I+=S*S,B+=4}}let M=0;I>0&&(M=E*E/I),M>l&&(l=M,a=A,r=k)}const o=a-s.xPos,D=r-s.yPos,_=Math.sqrt(o*o+D*D),d=t-s.width/2,m=c-s.height/2,f=Math.sqrt(d*d+m*m);let w=_/f*100;return w>100&&(w=100),w}const Je={meta:{mask:"round",mirror:!0,facingMode:"user"},async run({video:e,toast:s,meta:a,modifier:r}){return await new Promise(l=>{const t=!!(a.value.mirror&&a.value.mirror!=="preview"),c=L(e.value,t),i=document.createElement("canvas");i.width=b,i.height=b;let o;const D=setInterval(function(){if(e.value){const d=We(i,e.value);if(!o)o=ze(d);else if(Ge(d,o)>Ze){const m=L(e.value,t),f=r.value.base64?[m,c]:[Q(m),Q(c)];clearInterval(D),s(""),l({preview:m,result:f})}}},1e3/Xe);s("Move your head slowly. Your photo will be taken automatically")})}},Ke={meta:{mask:"square",facingMode:"environment",autoStart:!0},async run({video:e,toast:s,meta:a}){const r=!!(a.value.mirror&&a.value.mirror!=="preview"),{BrowserQRCodeReader:l}=await le(()=>import("./chunks/index.55ad3f9e.js"),[]),c=await new l().decodeOnceFromVideoElement(e.value),i=L(e.value,r),o=c.getText();return s(o),{preview:i,result:o}}},es=v("",4),ss=v("",3),as=v("",3),ts=v("",3),os=v("",3),ns=v("",3),ls=v("",3),rs=v("",3),cs=v("",2),ps={class:"truncate"},is=p("h3",{id:"encode-to-base64",tabindex:"-1"},[T("Encode to base64 "),p("a",{class:"header-anchor",href:"#encode-to-base64","aria-label":'Permalink to "Encode to base64"'},"​")],-1),ds=p("p",null,[T("You can add modifier "),p("code",null,"base64"),T(" to your "),p("code",null,"v-model"),T(", it's enforce result to "),p("a",{href:"https://en.wikipedia.org/wiki/Data_URI_scheme",target:"_blank",rel:"noreferrer"},"base64-dataURI"),T(".")],-1),us=p("b",null,"Note!",-1),ms=p("code",null,"v-model.base64",-1),ys=v("",2),hs={class:"truncate"},Ds=v("",7),Is=JSON.parse(`{"title":"Camera · Components","description":"Take picture from user's camera","frontmatter":{"title":"Camera · Components","description":"Take picture from user's camera"},"headers":[],"relativePath":"components/camera/index.md","filePath":"components/camera/index.md"}`),_s={name:"components/camera/index.md"},Vs=Object.assign(_s,{setup(e){const s=C(),a=C();return(r,l)=>{const t=N("preview");return h(),g("div",null,[es,n(t,{class:"flex-col"},{default:y(()=>[n(F)]),_:1}),ss,n(t,{class:"flex-col"},{default:y(()=>[n(F,{mirror:""})]),_:1}),as,n(t,{class:"flex-col"},{default:y(()=>[n(F,{mirror:"preview"})]),_:1}),ts,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{mask:"square"}),n(F,{mask:"round"}),n(F,{mask:"card"})]),_:1}),os,n(t,{class:"flex-col"},{default:y(()=>[n(F,{silent:""})]),_:1}),ns,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{adapter:x(Je)},null,8,["adapter"])]),_:1}),ls,n(t,{class:"flex-col space-y-2"},{default:y(()=>[n(F,{adapter:x(Ke)},null,8,["adapter"])]),_:1}),rs,n(t,{class:"flex-col"},{default:y(()=>[n(F,{modelValue:x(s),"onUpdate:modelValue":l[0]||(l[0]=c=>Y(s)?s.value=c:null)},null,8,["modelValue"])]),_:1}),cs,p("pre",ps,[p("code",null,j(x(s)),1)]),is,ds,n(ye,{dismissable:!1},{default:y(()=>[us,T(),ms,T(" on QRCodeAdapter has no effect, the result will always original scanned text. ")]),_:1}),n(t,{class:"flex-col"},{default:y(()=>[n(F,{modelValue:x(a),"onUpdate:modelValue":l[1]||(l[1]=c=>Y(a)?a.value=c:null),modelModifiers:{base64:!0}},null,8,["modelValue"])]),_:1}),ys,p("pre",hs,[p("code",null,j(x(a)),1)]),Ds])}}});export{Is as __pageData,Vs as default};
